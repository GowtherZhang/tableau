# 数据可视化：理念与基础

维度字段描述问题（是什么），聚合字段回答答案（有多少）
维度决定层次、度量默认聚合；离散生成标题、连续创建轴

## 问题解析与层次分析方法
### 聚合解析

* 何为聚合：
    聚合就是从数据库记录的明细级别，以多种方式聚合到问题所在的层次级别（即视图级别）的过程，聚合必然是从多变少的过程，维度则是由多变少聚合的依据。

* 聚合度
    当我们想表达一个问题的层次高于另一个问题的层次时，可以说这个问题的层次/详细级别（聚合度）高于另一个问题。
    聚合度越大，颗粒度越小
* 行级别数据是视图级别聚合的材料
    高级计算的实质就是多层次问题分析

### 层次解析
* 数据准备：
  数据并集：数据结构完全相同的表合并，行级别
  数据连接：表层次一致的数据匹配，行级别
  数据混合：独立的表先聚合，再连接，视图级别
  
  数据关系：通过物理层保留了并集和连接，通过逻辑层引入了逻辑关系

### 层次与计算

数据分析就是找到问题所对应的层次，从行级别查询字段并生成聚合的过程

行级别的运算就是在数据库的明细级别完成的计算，聚合计算是在视图层面完成的计算；而 FIXED/INCLUDE/EXCLUDE 三种 “LOD 表达式“ 只是在主视图层次引用另一个层次时使用的计算，类似于 SQL 聚合查询中的嵌套的子 SQL 聚合查询。 

业务的复杂性在于如何处理多个层次的问题，可以分为两类，分别使用交互和高级计算完成。

借助行级别计算、聚合计算、表计算和狭义 LOD 表达式，可以实现在一个视图中同时包含多个层次的数据分析。

## 字段类型、聚合方式和可视化逻辑

### 根据数据类型进行字段分类

字段是数据分析的最小单位和构成视图的基本材料，在计算机世界和分析世界中承担着承上启下的关键位置。

tableau 用位置区分维度/度量，用形状代表数据类型，用颜色表示连续/离散（蓝色代表离散，绿色代表连续）

### 根据离散与连续进行字段分类

* 离散生成标题（列表、清单）

* 连续的特征：

  * 默认有先后顺序：日期与数字，表达连续数据最佳的方法就是坐标轴

  * 可以无限切分与颜色标示：连续字段会使用渐变色，离散字段会使用有明显差异的颜色表示互不依赖。

* 连续与离散的表示方法与转换

​		绿色表示连续，蓝色表示离散

​		日期类型默认是离散的，可以在字段上右键转换为连续

​		非日期类型的维度字段，如果转换为连续或者拖曳到度量区域，则会自动计数聚合。

​		连续字段转换为离散维度的方式是数据桶，按照一定的间隔切分为多段组成的离散维度。

​		少数字段如年龄同时具有离散字段与连续字段的属性，需要根据不同的场景看待，可以复制一个字段转换为其他类型。

* 自带层次与连续性的日期

​		tableau 中双击日期字段，视图中会默认取年的层次开始分析，可以不断点击字段前面的 +/- 进行上钻或者下钻，引起视图层次的重新聚合。tableau 中也可以为 国家--省市--县乡 字段添加分层结构，达到相同的分析效果。

​		可以通过右键点击日期字段选择离散或连续的日期部分，根据需要显示格式。

### 度量和维度的聚合方式

* 度量的聚合方式

  ​	度量的默认聚合是总和

  ​	常见的还有 平均值 AVG , 中位数 MEDIAN, 最大值 MAX，最小值 MIN 

  推荐使用按住鼠标右键拖曳字段到视图，放入前会提示选择聚合方式

* 维度的聚合方式

  维度的常用聚合分为：

  ​	最大值\最小值：常用于具有连续性的日期聚合

  ​	重复计数 COUNT \ 不重复计数 COUNTID : 如 订单 ID 等离散字段聚合

  ​	特殊函数： ATTR 用于判断维度是否唯一，如果唯一显示他自己，不唯一则显示星号 * ，如在员工编号之后加入姓名的属性字段 ATTR([姓名])，如果

  推荐使用按住鼠标右键拖曳字段到视图，放入前会提示选择聚合方式
